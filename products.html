<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tienda de Productos</title>
    <style>
        /* Estilos generales */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }

        header {
            background-color: #333;
            color: white;
            padding: 10px 20px;
        }

        main {
            padding: 20px;
            max-width: 1200px;
            margin: auto;
        }

        h1 {
            margin: 0;
        }

        /* Estilos de la sección productos */
        #productos {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .producto {
            display: flex;
            flex-direction: column;
            align-items: center;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            text-align: center;
        }

        img {
            width: 100%;
            height: auto;
            border-radius: 5px;
        }

        /* Estilos de los botones */
        button {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: auto;
            width: 50%; /* Reducir el ancho del botón */
            text-align: center; /* Alinear el texto del botón al centro */
        }

        button:hover {
            background-color: #0f6622;
        }

        /* Botones adicionales */
        #btn_verCarrito {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            display: block;
            margin: 20px auto;
            font-size: 16px;
        }

        #btn_addProduct {
            background-color: #ff6347;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            display: block;
            margin: 20px auto;
            font-size: 16px;
        }

        #btn_addProduct:hover {
            background-color: #ff4500;
        }
    </style>
</head>

<body>
    <header>
        <h1>Tienda de Productos</h1>
    </header>

    <main>
        <section id="productos">
            <!-- Los productos se cargarán aquí dinámicamente -->
        </section>

        <button id="btn_verCarrito">Ver carrito</button>
        <button id="btn_addProduct">Agregar nuevo producto</button>
    </main>

    <script>
        // Establece los productos predeterminados en localStorage si no existen
        function establecerProductosPorDefecto() {
            const productosPorDefecto = [
                {
                    nombre: 'Coca-Cola',
                    precio: 1.5,
                    stock: 1000,
                    imagen: 'https://www.hkexpress.mx/web/image/product.template/16/image'
                },
                {
                    nombre: 'Pera',
                    precio: 0.5,
                    stock: 1000,
                    imagen: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT-KcEkwcPZ2w_6ZhTwimPcAx9EC447jo44F-Ft9fozjw&s'
                },
                {
                    nombre: 'Agua',
                    precio: 0.75,
                    stock: 1000,
                    imagen: 'https://chedrauimx.vtexassets.com/arquivos/ids/28878251-800-auto?v=638483737272400000&width=800&height=auto&aspect=true'
                },
                {
                    nombre: 'Pesa rusa',
                    precio: 20,
                    stock: 1000,
                    imagen: 'https://i.pinimg.com/736x/70/de/21/70de21ca73f76f9eeaf47ce6fd8ec239.jpg'
                }
            ];

            if (!localStorage.getItem('productos')) {
              //Guarda productos predeterminados en localstorage
              localStorage.setItem('productos', JSON.stringify(productosPorDefecto));
              //Envia los productos por defecto en existencia al back de ESTEBAN
              enviarProductosABaseDeDatos(productosPorDefecto);
            }
        }

        // Función para enviar productos a la base de datos
        async function enviarProductosABaseDeDatos(productos) {
            const apiUrl = 'URL_DE_ESTEBAN';

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(productos)
                });

                if (response.ok) {
                    console.log('Productos enviados a la base de datos con éxito.');
                } else {
                    console.error('Error al enviar los productos a la base de datos:', response.statusText);
                }
            } catch (error) {
                console.error('Error de red:', error);
            }
        }

        // Cargar productos desde localStorage
        function cargarProductos() {
            const productos = JSON.parse(localStorage.getItem('productos')) || [];
            const productosContainer = document.getElementById('productos');

            // Limpiar la sección de productos
            productosContainer.innerHTML = '';

            // Agregar cada producto a la sección de productos
            productos.forEach(producto => {
                const productoDiv = document.createElement('div');
                productoDiv.className = 'producto';

                // Crear elementos de imagen y botón
                const img = document.createElement('img');
                img.src = producto.imagen;
                img.alt = producto.nombre;

                const button = document.createElement('button');
                button.textContent = `Agregar ${producto.nombre} al carrito`;
                button.addEventListener('click', () => {
                    agregarAlCarrito(producto);
                });

                // Agregar elementos al contenedor de producto
                productoDiv.appendChild(img);
                productoDiv.appendChild(button);
                productosContainer.appendChild(productoDiv);
            });
        }

        // Agregar producto al carrito
        function agregarAlCarrito(producto) {
            const carrito = JSON.parse(localStorage.getItem('carrito')) || [];
            carrito.push(producto);
            localStorage.setItem('carrito', JSON.stringify(carrito));
            console.log(`${producto.nombre} agregado al carrito`);
        }

        // Inicialización
        window.addEventListener('DOMContentLoaded', () => {
            establecerProductosPorDefecto(); // Configura los productos predeterminados
            cargarProductos(); // Carga productos desde localStorage
        });

        // Botón para ver el carrito
        document.getElementById('btn_verCarrito').addEventListener('click', () => {
            window.location.href = 'BigCart.html';
        });

        // Botón para redirigir a la página de agregar productos
        document.getElementById('btn_addProduct').addEventListener('click', () => {
            window.location.href = 'add_product.html';
        });
    </script>
</body>

</html>
